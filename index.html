<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Year In Pixels</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/SebastianAigner/twemoji-amazing@1.0.0/twemoji-amazing.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&amp;family=Vujahday+Script&amp;display=swap">
    <link rel="icon" type="image/png" sizes="196x196" href="icons/favicon-196.png">
    <link rel="apple-touch-icon" href="icons/apple-icon-180.png">
    <link rel="manifest" href="manifest.json">
    <script src="https://unpkg.com/hyperscript.org@0.9.3"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G4VM9HGX49"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-G4VM9HGX49');
    </script>
    <script type="text/hyperscript">
      behavior Pixel -- When a pixel is clicked, it gets selected.
        on click
          remove .border-2 .border-dark .rounded .border from .border 
          add .border-2 .border-dark .rounded .border to me.children 
        end
      end
      behavior Color(c) -- When a color is clicked, it updates the selected pixel.
        on click
          remove .twa-orange-square .twa-red-square .twa-green-square .twa-yellow-square .twa-blue-square .twa-purple-square .twa-black-large-square .twa-white-large-square from .border
          if c == 0 add .twa-white-large-square to .border then set .border@data-color to 0 end
          if c == 1 add .twa-red-square to .border then set .border@data-color to 1 end
          if c == 2 add .twa-orange-square to .border then set .border@data-color to 2 end
          if c == 3 add .twa-yellow-square to .border then set .border@data-color to 3 end
          if c == 4 add .twa-green-square to .border then set .border@data-color to 4 end
          if c == 5 add .twa-blue-square to .border then set .border@data-color to 5 end
          if c == 6 add .twa-purple-square to .border then set .border@data-color to 6 end
          if c == 7 add .twa-black-large-square to .border then set .border@data-color to 7 end
          call save()
        end
      end
    </script>
    <style>
      body {
        font-family: 'VT323', monospace;
        font-size: 1em;
      }
      h1 {
        font-size: 2.5em;
      }
      .clickable {
        cursor: pointer;
      }
      .clickable:hover {
        opacity: 0.75;
      }
      .days>span {
        height: 1.636em;
      }
    </style>
  </head>
  <body>
    <h1 class="text-center my-4">Year In Pixels</h1>
    <div id="wrapper" class="d-flex justify-content-center">
      <div class="d-flex flex-column pt-4 pb-1 text-center justify-content-between days">
        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span>
        <span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span>
        <span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span>
        <span>22</span><span>23</span><span>24</span><span>25</span><span>26</span><span>27</span><span>28</span>
        <span>29</span><span>30</span><span>31</span>
      </div>
    </div>
    <div class="d-flex justify-content-center py-4">
      <div _="install Color(c: 1)" class="clickable"><i class="twa twa-2x twa-red-square"></i></div>
      <div _="install Color(c: 2)" class="clickable"><i class="twa twa-2x twa-orange-square"></i></div>
      <div _="install Color(c: 3)" class="clickable"><i class="twa twa-2x twa-yellow-square"></i></div>
      <div _="install Color(c: 4)" class="clickable"><i class="twa twa-2x twa-green-square"></i></div>
      <div _="install Color(c: 5)" class="clickable"><i class="twa twa-2x twa-blue-square"></i></div>
      <div _="install Color(c: 6)" class="clickable"><i class="twa twa-2x twa-purple-square"></i></div>
      <div _="install Color(c: 7)" class="clickable"><i class="twa twa-2x twa-black-large-square"></i></div>
      <div _="install Color(c: 0)" class="clickable"><i class="twa twa-2x twa-wastebasket"></i></div>
    </div>
    <div class="d-flex justify-content-center justify-content-evenly mx-auto mb-5" style="width: 20em;">
      <a class="text-muted clickable" _="on click get prompt('Paste exported data here:') js(it) if(it) { localStorage.setItem('pixels', it); location.reload(); } end">Import</a>
      <a class="text-muted clickable" _="on click js return localStorage.getItem('pixels') end get prompt('You can copy the following text and import it on another device.', it)">Export</a>
      <a class="text-muted clickable" _="on click get confirm('Are you sure you want to clear your data?') js(it) if(it) { localStorage.removeItem('pixels'); location.reload(); } end">Clear</a>
      <a class="text-muted clickable" _="on click alert('Keep track of whatever you want in a year using pixels! Data is stored on this device, but you can move it with the import/export buttons. Created by @_djpeacher.')">About</a>
    </div>
    <script>
      function save() {
        const colors = Array.prototype.slice.call(document.body.getElementsByTagName("i")).map(function(e) {
          return e.getAttribute('data-color')
        }).join('');
        const year = localStorage.getItem('pixels').split(',')[0];
        localStorage.setItem('pixels', year + ',' + colors);
      }
      
      function calcDayOfYear(year, month, day) {
        // https://stackoverflow.com/questions/8619879/javascript-calculate-the-day-of-the-year-1-366
        const now = new Date(year, month, day);
        const start = new Date(year, 0, 0);
        const diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
        const oneDay = 1000 * 60 * 60 * 24;
        return Math.floor(diff / oneDay);
      }
      
      // Init data.
      let pixels = localStorage.getItem('pixels');
      if (!pixels) {
        pixels = new Date().getFullYear().toString();
        localStorage.setItem('pixels', pixels);
      }
      pixels = pixels.split(',');
      const year = pixels[0];
      const colors = pixels[1] || [];
      
      // Render calendar.
      const monthNames = ['J', 'F', 'M', 'A', 'M', 'J', 'J', 'A', 'S', 'O', 'N', 'D'];
      [...Array(12)].forEach((_, month) => {
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const monthPixels = [...Array(daysInMonth)].map((_, day) => {
          const dayOfYear = calcDayOfYear(year, month, day);
          const color = colors[dayOfYear] || 0;
          const emoji = {
            0: 'twa-white-large-square',
            1: 'twa-red-square',
            2: 'twa-orange-square',
            3: 'twa-yellow-square',
            4: 'twa-green-square',
            5: 'twa-blue-square',
            6: 'twa-purple-square',
            7: 'twa-black-large-square',
          } [color];
          return `<div _='install Pixel'><i class='clickable twa twa-lg ${emoji}' data-color='${color}'></i></div>`
        }).join("");
        const title = `<div class="text-center">${monthNames[month]}</div>`;
        document.getElementById("wrapper").insertAdjacentHTML('beforeend', `<div class='d-flex flex-column'>${title}${monthPixels}</div>`)
      });
      
      // Save.
      save();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  </body>
</html>